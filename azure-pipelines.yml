# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pr: none

pool:
  vmImage: 'ubuntu-latest'

steps:

- script: |
    curl https://cli-assets.heroku.com/install.sh | sh
    export HEROKU_API_KEY=$HEROKU_TOKEN
    heroku login
    git checkout $(Build.SourceBranchName)
    git remote add heroku https://heroku:$(heroku_token)@git.heroku.com/delta-core.git
    git push heroku $(Build.SourceBranchName)
    heroku run -a delta-core python manage.py db upgrade
  displayName: 'Delta Core Service Heroku Deployment'
